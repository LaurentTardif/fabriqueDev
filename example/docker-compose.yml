version: "3"

services:
    gitlab:
        image: gitlab/gitlab-ce:9.0.0-ce.0
        ports:
            - 8080:80
            - 8443:443
        networks:
            - frabriqueDev 

    jenkins:
        image: jenkins:2.32.3-alpine
        ports:
            - 8081:8080
        volumes:
            - /tmp/fabriq/jenkins:/var/jenkins_home 
        networks:
            - frabriqueDev

    nexus:
        image: sonatype/nexus3
        volumes:
            - /tmp/fabriq/nexus:/nexus-data
        ports:
            - 8082:8081 
        networks:
            - frabriqueDev

    dockerhub:
        image: registry:2
        ports:
            - 5000:5000
        volumes:
            - /tmp/fabriq/dockerregistry/data:/var/lib/registry
        networks:
            - frabriqueDev   

    rundeck:
        image: jordan/rundeck
        ports:
            - 8083:4440
            - 8483:4443
        volumes:
            - /tmp/fabriq/rundeck/etc:/etc/rundeck
            - /tmp/fabriq/rundeck/var:/var/rundeck
            - /tmp/fabriq/rundeck/varlog:/var/log/rundeck
            - /tmp/fabriq/rundeck/plugins:/opt/rundeck-plugins
            - /tmp/fabriq/rundeck/log:/var/lib/rundeck/logs
            - /tmp/fabriq/rundeck/data:/var/lib/rundeck/var/storage
        environment:
            - RUNDECK_ADMIN_PASSWORD=admin
        networks:
            - frabriqueDev  

    nginx:
        image: nginx
        ports:
            - 8084:80
        volumes:
            - /tmp/fabriq/nginx/html:/usr/share/nginx/html 
        networks:
            - frabriqueDev
            
    sonarqube:
        image: sonarqube:6.3-alpine
        ports:
            - 8085:9000
        volumes:
            - /tmp/fabriq/sonarqube/conf:/opt/sonarqube/conf
            - /tmp/fabriq/sonarqube/data:/opt/sonarqube/data
            - /tmp/fabriq/sonarqube/extensions:/opt/sonarqube/extensions
            - /tmp/fabriq/sonarqube/bundled-plugins:/opt/sonarqube/lib/bundled-plugins
        networks:
            - frabriqueDev  

    redminedb:
        image: mariadb
        environment:
            MYSQL_ROOT_PASSWORD: example
            MYSQL_DATABASE: redmine
        volumes:
            - /tmp/fabriq/redmine/db:/var/lib/mysql
        networks:
            - frabriqueDev

    redmine:
        image: redmine
        ports:
           - 3000:3000
        environment:
           REDMINE_DB_MYSQL: redminedb
           REDMINE_DB_PASSWORD: example
        volumes:
            - /tmp/fabriq/redmine/files:/usr/src/redmine/files        
        depends_on:
           - redminedb
        networks:
            - frabriqueDev

    wekan:
        image: mquandalle/wekan:latest
        ports:
            - 8086:80
        environment:
            - MONGO_URL=mongodb://wekandb/wekan
            - ROOT_URL=http://localhost:8086
        networks:
            - frabriqueDev  
    
    wekandb:
        image: mongo
        volumes:
            - /tmp/fabriq/wekan/mongo:/data/db
        networks:
            - frabriqueDev  

    mattermost:
        image: mattermost/mattermost-preview:3.7
        ports:
            - 8087:8065
        networks:
            - frabriqueDev  

    svn:
        image: marvambass/subversion
        ports:
            - 8090:80
        volumes:
            - /tmp/fabriq/svn/local:/var/local/svn
            - /tmp/fabriq/svn/backup:/var/svn-backup
            - /tmp/fabriq/svn/dav:/etc/apache2/dav_svn/
        networks:
            - frabriqueDev  
        
    bamboo:
        image: cptactionhank/atlassian-bamboo:5.15.3
        ports:
            - 8091:8085
        volumes:
            - /tmp/fabriq/bamboo/data:/var/atlassian/bamboo
            - /tmp/fabriq/bamboo/logs:/opt/atlassian/bamboo/logs
        networks:
            - frabriqueDev  
            
    artifactory:
        image: docker.bintray.io/jfrog/artifactory-oss:5.2.0
        ports:
            - 8092:8081
        volumes:
            - /tmp/fabriq/artifactory:/var/opt/jfrog/artifactory
        networks:
            - frabriqueDev  

    gocd-server:
        image: gocd/gocd-server:v17.3.0
        ports:
            - 8093:8153
            - 8094:8154
        volumes:
            - /tmp/fabriq/godata/addons:/godata/addons
            - /tmp/fabriq/godata/artifacts:/godata/artifacts
            - /tmp/fabriq/godata/config:/godata/config
            - /tmp/fabriq/godata/db:/godata/db
            - /tmp/fabriq/godata/logs:/godata/logs
            - /tmp/fabriq/godata/plugins:/godata/plugins 
            - /tmp/fabriq/godata/go:/home/go 
        networks:
            - frabriqueDev  
    gocd-dev:
        image: gocd/gocd-dev:16.9.0
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - /tmp/fabriq/godata/go-agent/log:/var/log/go-server/
        links:
            - gocd-server
        networks:
            - frabriqueDev 

    httpd:
        image: httpd:2.4.25-alpine
        ports:
            - 8095:80
        volumes:
            - /tmp/fabriq/httpd/html:/usr/local/apache2/htdocs/ 
        networks:
            - frabriqueDev 
        
    teamscale:
        image: cqse/teamscale:teamscale_v3.2.0
        volumes:
            - /tmp/fabriq/teamscale/storage:/opt/teamscale/storage
            - /tmp/fabriq/teamscale/logs:/opt/teamscale/logs
            - /tmp/fabriq/teamscale/backup:/backup
        ports:
            - 8096:8080
        networks:
            - frabriqueDev 

    jira:
        image: cptactionhank/atlassian-jira:7.3.3
        volumes:
            - /tmp/fabriq/jira/logs:/opt/atlassian/jira/logs
        ports:
            - 8097:8080
        networks:
            - frabriqueDev 
    
    mercurial:
        image: miguillo/mercurial-server
        ports:
            - 8100:2222
        volumes:
            - /tmp/fabriq/mercurial/:/var/lib/mercurial-server/repos
        networks:
            - frabriqueDev 

    bitbucket:
        image: cptactionhank/atlassian-bitbucket:4.14.4
        volumes:
            - /tmp/fabriq/bitbucket/home:/var/atlassian/bitbucket
            - /tmp/fabriq/bitbucket/logs:/opt/atlassian/bitbucket/logs
        ports:
            - 8200:7990
        networks:
            - frabriqueDev 
        
    teamcity:
        image: jetbrains/teamcity-server:10.0.5
        volumes:
            - /tmp/fabriq/teamcity/home:/data/teamcity_server/datadir
            - /tmp/fabriq/teamcity/logs:/opt/teamcity/logs
        ports:
            - 8101:8111
        networks:
            - frabriqueDev  
 
networks:
  frabriqueDev:
    driver: bridge
